Install the VPNaaS extension for neutron:

I don't know how that would work with the L3 HA, so I would rather go for a single controller approach for now, but this should be applicable if you have several controllers, just apply it on each of them.

$ sudo apt-get install strongswan
$ sudo apt-get install neutron-vpn-agent #OR neutron-vpnaas-agent for Newton

check vpn_agent.ini (vpn_device_driver. In case of Newton, add in default this : "interface_driver = openvswitch") and neutron_vpnaas.conf files so they look like this:

================================================
vpn_agent.ini :
===============

[DEFAULT]
# VPN-Agent configuration file
# Note vpn-agent inherits l3-agent, so you can use configs on l3-agent also

[vpnagent]
# vpn device drivers which vpn agent will use
# If we want to use multiple drivers,  we need to define this option multiple times.
# NOTE: StrongSwan and openSwan cannot be installed at the same time. Thus, both cannot
#       be enabled for use. In the future when flavors/STF support is available,
#       this will still constrain the flavors which can be used together.
# vpn_device_driver=neutron_vpnaas.services.vpn.device_drivers.ipsec.OpenSwanDriver
# vpn_device_driver=neutron_vpnaas.services.vpn.device_drivers.cisco_ipsec.CiscoCsrIPsecDriver
# vpn_device_driver=neutron_vpnaas.services.vpn.device_drivers.vyatta_ipsec.VyattaIPSecDriver
vpn_device_driver=neutron_vpnaas.services.vpn.device_drivers.strongswan_ipsec.StrongSwanDriver
# vpn_device_driver=neutron_vpnaas.services.vpn.device_drivers.fedora_strongswan_ipsec.FedoraStrongSwanDriver
# vpn_device_driver=neutron_vpnaas.services.vpn.device_drivers.libreswan_ipsec.LibreSwanDriver
# vpn_device_driver=another_driver

[ipsec]
# Status check interval
# ipsec_status_check_interval=60

# Enable detail logging for ipsec pluto process.
# If the flag set to True, the detailed logging will
# be written into config_base_dir/<pid>/log."
# NOTE: this applies to OpenSwan and Libraswan, and
# that StrongSwan has logging that logs to syslog.
# enable_detailed_logging=False

[strongswan]
# For fedora use:
# default_config_area=/usr/share/strongswan/templates/config/strongswan.d
# Default is for ubuntu use, /etc/strongswan.d
default_config_area=/etc/strongswan.d

[pluto]
# Initial interval in seconds for checking if pluto daemon is shutdown
# shutdown_check_timeout=1
#
# The maximum number of retries for checking for pluto daemon shutdown
# shutdown_check_retries=5
#
# A factor to increase the retry interval for each retry
# shutdown_check_back_off=1.5

neutron_vpnaas.conf :
=====================


[service_providers]
# Must be in form:
# service_provider=<service_type>:<name>:<driver>[:default]
# List of allowed service types includes VPN
# Combination of <service type> and <name> must be unique; <driver> must also be unique
# This is multiline option
# service_provider=VPN:openswan:neutron_vpnaas.services.vpn.service_drivers.ipsec.IPsecVPNDriver:default
# Uncomment the following line (and comment out the OpenSwan VPN line) to enable Cisco's VPN driver.
# service_provider=VPN:cisco:neutron_vpnaas.services.vpn.service_drivers.cisco_ipsec.CiscoCsrIPsecVPNDriver:default
# Uncomment the following line (and comment out the OpenSwan VPN line) to enable Brocade Vyatta's VPN driver.
# service_provider=VPN:vyatta:neutron_vpnaas.services.vpn.service_drivers.vyatta_ipsec.VyattaIPsecDriver:default

service_provider = VPN:vpnaas:neutron_vpnaas.services.vpn.service_drivers.ipsec.IPsecVPNDriver:default


======================================================================================

add vpnaas in service provider in neutron.conf:
"service_plugins =neutron.services.l3_router.l3_router_plugin.L3RouterPlugin,neutron.services.metering.metering_plugin.MeteringPlugin,vpnaas"
The other services might be different

$ sudo /usr/bin/neutron-db-manage --service vpnaas --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head
or for Newton
$ sudo /usr/bin/neutron-db-manage --subproject neutron-vpnaas --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head

in /etc/openstack-dashboard/local_settings.py set enable_vpn to True

to fix an issue :

$ sudo apparmor_parser -R /etc/apparmor.d/usr.lib.ipsec.charon
$ sudo apparmor_parser -R /etc/apparmor.d/usr.lib.ipsec.stroke

then, until Mitaka:
$ sudo service neutron-server restart
$ sudo service neutron-l3 stop 
$ sudo service neutron-vpn-agent restart
$ sudo service apache2 restart

for Newton:
$ sudo service neutron-server restart
$ sudo service neutron-l3-agent stop 
$ sudo service neutron-vpnaas-agent restart
$ sudo service apache2 restart